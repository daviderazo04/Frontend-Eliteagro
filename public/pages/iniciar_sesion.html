<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión - Elite Agro</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/estilo_responsive.css">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="../index_updated.html">
                <img src="../images/logo.png" alt="Logo" height="50" width="50">
                Elite Agro
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="../index_updated.html">Inicio</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a href="productos.html" class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">Productos</a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="productos.html">Alimentos y Suplementos</a></li>
                            <li><a class="dropdown-item" href="productos.html">Equipos de Manejo</a></li>
                            <li><a class="dropdown-item" href="productos.html">Equipamiento Ecuestre</a></li>
                            <li><a class="dropdown-item" href="productos.html">Medicación y Veterinaria</a></li>
                            <li><a class="dropdown-item" href="productos.html">Infraestructura</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a href="servicios.html" class="nav-link">Servicios</a>
                    </li>
                    <li class="nav-item">
                        <a href="nosotros.html" class="nav-link">Nosotros</a>
                    </li>
                    <li class="nav-item">
                        <a href="contactame.html" class="nav-link">Contacto</a>
                    </li>
                    <li class="nav-item">
                        <a href="preferencias.html" class="nav-link">Preferencias</a>
                    </li>
                </ul>
                <form class="d-flex ms-auto me-auto align-items-center">
                    <input class="form-control me-2" type="search" placeholder="Buscar productos" aria-label="Buscar">
                    <button class="btn btn-outline-success" type="submit">Buscar</button>
                </form>
                <div class="d-flex align-items-center ms-auto">
                    <a href="carrito.html" class="btn btn-outline-primary me-4 position-relative">
                        <i class="fas fa-shopping-cart"></i> Carrito
                        <span id="contadorCarrito"
                            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"></span>
                    </a>
                    <a href="iniciar_sesion.html" class="btn btn-outline-secondary" id="loginButton">
                        <i class="fas fa-user"></i> Iniciar sesión
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Espaciado para evitar que el contenido sea tapado por el navbar -->
    <div class="mt-5 pt-5"></div>

    <!-- Sección de Inicio de Sesión -->
    <div class="container mt-5" id="loginSection">
        <h1 class="text-center mb-4">Iniciar Sesión</h1>
        <form id="loginForm" class="mt-4">
            <div class="mb-3">
                <label for="username" class="form-label">Nombre de Usuario</label>
                <input type="text" id="username" name="username" class="form-control" placeholder="Ingrese su usuario"
                    required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Contraseña</label>
                <input type="password" id="password" name="password" class="form-control"
                    placeholder="Ingrese su contraseña" required>
            </div>
            <button type="submit" class="btn btn-success w-100 mb-3">Iniciar Sesión</button>
        </form>
        <div class="text-center">
            <p>¿No tienes una cuenta?</p>
            <a href="registrarse.html" class="btn btn-outline-success">Registrarse</a>
        </div>
    </div>

    <!-- Sección de Bienvenida -->
    <div id="welcomeSection" class="container mt-5" style="display: none;">
        <h2 class="text-center">Bienvenido, <span id="welcomeUsername"></span></h2>
        <h3 class="text-center mt-4">Tus Compras Anteriores</h3>
        <ul id="purchaseList" class="list-group mt-3">
            <!-- Aquí se llenará la lista de compras -->
        </ul>
        <button id="logoutButton" class="btn btn-danger w-100 mt-4">Cerrar Sesión</button>
    </div>

    <!-- Footer -->
    <footer class="footer-section bg-dark text-light pt-5 pb-3 mt-5">
        <div class="container">
            <div class="text-center mt-4">
                <p>© 2024 Elite Agro. Todos los derechos reservados.</p>
                <a href="#" class="text-light mx-2"><i class="fab fa-facebook fa-2x"></i></a>
                <a href="#" class="text-light mx-2"><i class="fab fa-twitter fa-2x"></i></a>
                <a href="#" class="text-light mx-2"><i class="fab fa-instagram fa-2x"></i></a>
            </div>
        </div>
    </footer>

    <script>
        // Función para llenar la lista de compras simuladas
        function renderPurchaseList() {
            const purchaseList = document.getElementById('purchaseList');
            const purchases = [
                'Compra #1: Herramientas de Manejo - $50.00',
                'Compra #2: Alimentos - $120.00',
                'Compra #3: Equipos Ecuestres - $250.00'
            ];

            purchaseList.innerHTML = ''; // Limpiar la lista antes de llenarla

            purchases.forEach(purchase => {
                const li = document.createElement('li');
                li.textContent = purchase;
                li.className = 'list-group-item';
                purchaseList.appendChild(li);
            });
        }

        // Detectar si el usuario ya inició sesión
        function checkLoginStatus() {
            const username = localStorage.getItem('username');
            const role = localStorage.getItem('role');

            if (username) {
                if (role === 'cliente') {
                    document.getElementById('loginSection').style.display = 'none'; // Ocultar formulario de login
                    document.getElementById('welcomeSection').style.display = 'block'; // Mostrar sección de bienvenida
                    document.getElementById('welcomeUsername').textContent = username;
                    renderPurchaseList();
                } else if (role === 'administrador') {
                    window.location.href = 'administrador.html'; // Redirigir a administrador.html
                }
            }
        }

        // Cerrar sesión
        document.getElementById('logoutButton').addEventListener('click', () => {
            localStorage.removeItem('username');
            localStorage.removeItem('role');
            location.reload();
        });

        // Manejar el evento de envío del formulario de inicio de sesión
        document.getElementById('loginForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const loginData = { email: username, password: password };

            try {
                const response = await fetch('http://localhost:8080/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(loginData)
                });

                const data = await response.json(); // Leer la respuesta como JSON

                if (response.ok && data.status === "Login successful") {
                    alert(data.status); // Mostrar mensaje de éxito
                    localStorage.setItem('username', username); // Guardar el nombre de usuario en localStorage
                    localStorage.setItem('role', data.role); // Guardar el rol en localStorage

                    if (data.role === 'cliente') {
                        location.reload(); // Recargar para mostrar la sección de bienvenida
                    } else if (data.role === 'administrador') {
                        window.location.href = 'administrador.html'; // Redirigir a administrador.html
                    }
                } else {
                    alert('Error: ' + data.status); // Mostrar alerta de error
                }
            } catch (error) {
                console.error('Error en la solicitud:', error);
                alert('Ocurrió un error al intentar iniciar sesión. Por favor, inténtalo más tarde.');
            }
        });

        // Verificar estado de inicio de sesión al cargar la página
        document.addEventListener('DOMContentLoaded', checkLoginStatus);
    </script>




</body>

</html>